<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Панель администратора" }}</title>
    <link rel="stylesheet" href="/admin/static/admin.v2.css?v={{ static_v or 'dev' }}" />
  </head>
  <body>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">CryptoSensei · Панель</div>
        <div class="topbar__right">
          <button class="nav-toggle" type="button" aria-label="Меню" aria-controls="navDrawer" aria-expanded="false">
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
            <span class="nav-toggle__bar"></span>
          </button>

          <div class="nav">
            <a href="/admin/posts" class="{{ 'active' if section=='posts' else '' }}">Посты</a>
            <a href="/admin/webinars" class="{{ 'active' if section=='webinars' else '' }}">Вебинары</a>
            <a href="/admin/tickets" class="{{ 'active' if section=='tickets' else '' }}">Тикеты</a>
            <a href="/admin/admins" class="{{ 'active' if section=='admins' else '' }}">Админы</a>
            <a href="/admin/data" class="{{ 'active' if section=='data' else '' }}">Данные</a>
            <a href="/admin/users" class="{{ 'active' if section=='users' else '' }}">Пользователи панели</a>
          </div>
          <div class="topbar__meta">
            {{ admin_user or "" }}
          </div>
          <form method="post" action="/admin/logout">
            <button class="link-btn" type="submit">Выйти</button>
          </form>
        </div>
      </div>

      <!-- Mobile drawer navigation -->
      <div class="nav-overlay" data-nav-close></div>
      <aside class="nav-drawer" id="navDrawer" aria-hidden="true">
        <div class="nav-drawer__head">
          <div>
            <div class="nav-drawer__brand">CryptoSensei</div>
            <div class="muted" style="margin-top:4px">{{ admin_user or "" }}</div>
          </div>
          <button class="link-btn" type="button" data-nav-close>Закрыть</button>
        </div>
        <nav class="nav nav--drawer">
          <a href="/admin/posts" class="{{ 'active' if section=='posts' else '' }}">Посты</a>
          <a href="/admin/webinars" class="{{ 'active' if section=='webinars' else '' }}">Вебинары</a>
          <a href="/admin/tickets" class="{{ 'active' if section=='tickets' else '' }}">Тикеты</a>
          <a href="/admin/admins" class="{{ 'active' if section=='admins' else '' }}">Админы</a>
          <a href="/admin/data" class="{{ 'active' if section=='data' else '' }}">Данные</a>
          <a href="/admin/users" class="{{ 'active' if section=='users' else '' }}">Пользователи панели</a>
        </nav>
        <form method="post" action="/admin/logout" style="margin-top:12px">
          <button class="btn danger" type="submit" style="width:100%">Выйти</button>
        </form>
      </aside>

      {% if flash %}
        <div class="flash {{ 'ok' if flash_kind=='ok' else 'bad' }}">
          <strong>{{ flash }}</strong>
          {% if flash_details %}<div class="muted" style="margin-top:6px">{{ flash_details }}</div>{% endif %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </div>

    <script>
      (function () {
        var body = document.body;
        var btn = document.querySelector('.nav-toggle');
        var drawer = document.getElementById('navDrawer');
        var overlay = document.querySelector('.nav-overlay');
        if (!btn || !drawer || !overlay) return;

        function setOpen(open) {
          body.setAttribute('data-nav-open', open ? '1' : '0');
          drawer.setAttribute('aria-hidden', open ? 'false' : 'true');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        }

        btn.addEventListener('click', function () {
          var isOpen = body.getAttribute('data-nav-open') === '1';
          setOpen(!isOpen);
        });

        document.querySelectorAll('[data-nav-close]').forEach(function (el) {
          el.addEventListener('click', function () { setOpen(false); });
        });

        // close on navigation
        drawer.querySelectorAll('a').forEach(function (a) {
          a.addEventListener('click', function () { setOpen(false); });
        });

        // ESC
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') setOpen(false);
        });

        setOpen(false);
      })();
    </script>
  </body>
</html>

