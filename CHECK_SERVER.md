# üîç –ü–†–û–í–ï–†–ö–ê –°–ï–†–í–ï–†–ê –ò CORS

## –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏ –¥–∞–∂–µ —á–µ—Ä–µ–∑ ngrok

## ‚úÖ –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨:

### 1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ?

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–∏—Ç–µ:**
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `127.0.0.1` –∏–ª–∏ `localhost` –≤–º–µ—Å—Ç–æ `0.0.0.0` - —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞!**

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs

–î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**
```bash
cd backend
python test_cors.py
```

–≠—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏.

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ ngrok

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:**
```bash
ngrok http 8000
```

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://xxxx-xx-xx-xx-xx.ngrok-free.app`)

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
```
https://xxxx-xx-xx-xx-xx.ngrok-free.app/docs
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS:**
```bash
cd backend
python test_cors.py https://xxxx-xx-xx-xx-xx.ngrok-free.app
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network tab ‚Üí —Å–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞.

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- `Access-Control-Allow-Origin: *`
- `Access-Control-Allow-Methods: *`
- `Access-Control-Allow-Headers: *`

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: ngrok –±–ª–æ–∫–∏—Ä—É–µ—Ç CORS

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –≤ ngrok –∫–æ–Ω—Ñ–∏–≥ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–ª–∞–≥:
```bash
ngrok http 8000 --host-header="localhost:8000"
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ë—Ä–∞—É–∑–µ—Ä –∫—ç—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** 
- –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
- –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "Disable cache"

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞: `python run.py`
3. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è "Application startup complete"

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤ .env

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ `miniapp/react-app/.env` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –æ—Ç ngrok
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ React –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

## üéØ –ü–û–®–ê–ì–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê:

1. ‚úÖ Backend –∑–∞–ø—É—â–µ–Ω: `python run.py` ‚Üí –≤–∏–¥–∏—Ç–µ "Uvicorn running on http://0.0.0.0:8000"
2. ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç: http://localhost:8000/docs –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
3. ‚úÖ ngrok –∑–∞–ø—É—â–µ–Ω: `ngrok http 8000` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç HTTPS URL
4. ‚úÖ ngrok URL —Ä–∞–±–æ—Ç–∞–µ—Ç: https://xxxx.ngrok-free.app/docs –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
5. ‚úÖ .env –æ–±–Ω–æ–≤–ª–µ–Ω: `REACT_APP_API_URL=https://xxxx.ngrok-free.app`
6. ‚úÖ React –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env
7. ‚úÖ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –µ—Å—Ç—å: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ `test_cors.py` –∏–ª–∏ DevTools

## üÜò –ï–°–õ–ò –í–°–ï –ï–©–ï –ù–ï –†–ê–ë–û–¢–ê–ï–¢:

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å origin –≤ CORS (–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞):

–í `backend/app/main.py` –∑–∞–º–µ–Ω–∏—Ç–µ:
```python
allow_origins=["*"],
```

–ù–∞:
```python
allow_origins=[
    "http://localhost:3000",
    "https://web.telegram.org",
],
```

–ò –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend.


