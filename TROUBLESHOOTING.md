# Решение проблем с подключением к серверу

## Возможные причины недоступности сервера

### 1. Сервер не запущен или запущен на другом порту

**Проверка:**
```bash
# Windows
netstat -ano | findstr :8000

# Linux/Mac
lsof -i :8000
# или
netstat -tuln | grep 8000
```

**Решение:**
- Убедитесь, что сервер запущен: `cd backend && python run.py`
- Проверьте, что в консоли видно сообщение о запуске сервера
- Проверьте, что порт 8000 свободен

### 2. Неправильный URL API в React приложении

**Проверка:**
- Откройте консоль браузера (F12)
- Найдите сообщение `API Base URL configured: ...`
- Убедитесь, что URL правильный

**Решение:**
- Создайте файл `.env` в папке `miniapp/react-app/`:
  ```
  REACT_APP_API_URL=http://localhost:8000
  ```
- Перезапустите React приложение после создания `.env`

### 3. Проблема с CORS (Cross-Origin Resource Sharing)

**Симптомы:**
- В консоли браузера ошибка типа `CORS policy: No 'Access-Control-Allow-Origin'`
- Запросы блокируются браузером

**Решение:**
- Backend уже настроен на `allow_origins=["*"]`, но проверьте файл `backend/app/main.py`
- Если используете другой домен, добавьте его в `allow_origins`

### 4. Проблема с localhost в Telegram WebApp

**Важно:** Если приложение запущено в Telegram WebApp, `localhost` может не работать!

**Решение:**
- Для локальной разработки используйте туннель (ngrok, localtunnel)
- Или используйте IP адрес вашего компьютера вместо localhost:
  ```
  REACT_APP_API_URL=http://192.168.1.XXX:8000
  ```
  (замените XXX на ваш локальный IP)

### 5. Файрвол или антивирус блокирует подключение

**Решение:**
- Добавьте исключение для порта 8000 в файрволе
- Временно отключите антивирус для проверки

### 6. Сервер запущен, но не слушает на правильном интерфейсе

**Проверка:**
- В `backend/run.py` должно быть `host="0.0.0.0"` (это правильно)
- Если `host="127.0.0.1"`, сервер будет доступен только локально

## Диагностика

### Шаг 1: Проверьте, что сервер запущен

```bash
cd backend
python run.py
```

Должно появиться сообщение типа:
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

### Шаг 2: Проверьте доступность сервера в браузере

Откройте в браузере: http://localhost:8000

Должен появиться JSON:
```json
{"Status": "OK", "message": "Crypto Analytics API is running"}
```

### Шаг 3: Запустите тестовый скрипт

```bash
cd backend
python test_server.py
```

Этот скрипт проверит все основные эндпоинты.

### Шаг 4: Проверьте консоль браузера

1. Откройте DevTools (F12)
2. Перейдите на вкладку Console
3. Найдите сообщения об ошибках подключения
4. Проверьте вкладку Network - видны ли запросы к API?

### Шаг 5: Проверьте логи сервера

В консоли, где запущен backend, должны появляться логи запросов:
```
INFO:     127.0.0.1:XXXXX - "GET / HTTP/1.1" 200 OK
```

## Быстрое решение

1. **Убедитесь, что backend запущен:**
   ```bash
   cd backend
   python run.py
   ```

2. **Проверьте URL в браузере:**
   Откройте http://localhost:8000/docs - должна открыться документация Swagger

3. **Проверьте консоль React приложения:**
   - Должно быть сообщение `API Base URL configured: http://localhost:8000`
   - Если URL неправильный, создайте `.env` файл

4. **Если используете Telegram WebApp:**
   - Используйте ngrok или другой туннель
   - Или используйте IP адрес вместо localhost

## Использование ngrok для Telegram WebApp

1. Установите ngrok: https://ngrok.com/
2. Запустите backend на порту 8000
3. В другом терминале запустите:
   ```bash
   ngrok http 8000
   ```
4. Скопируйте HTTPS URL (например: `https://abc123.ngrok.io`)
5. Создайте `.env` в `miniapp/react-app/`:
   ```
   REACT_APP_API_URL=https://abc123.ngrok.io
   ```
6. Перезапустите React приложение

## Проверка через curl

```bash
# Проверка основного эндпоинта
curl http://localhost:8000/

# Проверка вебинаров
curl http://localhost:8000/webinars/

# Проверка пользователей
curl http://localhost:8000/users/
```

Если curl работает, но React приложение нет - проблема в CORS или URL конфигурации.

